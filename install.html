<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Whispix Linux</title>
		<link rel="icon" href="/favicon.ico" type="image/x-icon">
		<link rel="stylesheet" href="style.css">
	</head>
	<body>
		<header>
			<h1>Whispix</h1>
			<a href="/whispix/index.html">Home</a>
                        <a href="/whispix/install.html">Installation Guide</a>
                        <a href="/whispix/about.html">About</a>
		</header>
		<main>
			<b>1. Preparations and Requirements</b>
			<p class="instructions">
			Before anything, I'd like to say that this is just a simple guide to get you started
			and that you are free to customize Whispix in any way you'd like.
			Now, to begin, you must be booted into a host disk that is different
			from your target disk. The most idea way to achieve this is to flash
			a live linux iso to a usb, cd, or other bootable device. Recommended
			live images are Void, Arch, Artix, Gentoo, and CRUX. You may download
			one of these images or another minimal live iso and flash it to a usb or cd
			that doesn't have any important data saved to it. FLASHING A USB OR CD
			WILL WIPE ALL DATA! Below is an example of flashing a void iso to the device at /dev/sdb.
			</p>
			<code>
			dd if=void.iso of=/dev/sdb bs=4M status=progress
			</code>
			<p class="instructions">
			Once booted into the live iso on a system with the target drive still attached,
			you may move on to the following steps.
			</p>
			<b>2. Partitioning and Formatting</b>
			<p class="instructions">
			Note: MAKE SURE YOU FORMAT AND PARTITION THE CORRECT DISK AS ALL DATA WILL BE WIPED!
			Depending on your type of system and expectations, you will be expected to partition and format differently.
			On a BIOS system, it is advised to use MBR as your partition scheme, while on a newer UEFI system, it is more
			common to use GPT. UEFI systems will also expect an EFI partition which should be formatted as FAT32 for best
			compatibility. In the end, you are expected to at least have a root partition, optionally a swap partition, and
			an EFI partition depending on your setup. You may also divide your root into multiple partitions dedicated to
			locations such as /var, /etc, /home, etc., though this is more advanced. Below are basic reference tables for BIOS
			and UEFI.
			</p>
			<b>BIOS with MBR</b>
			<table>
				<tr>
					<th>Mount point</th>
					<th>Partition type</th>
					<th>Recommended size</th>
				</tr>
				<tr>
					<th>swap</th>
					<th>swap</th>
					<th>4GB+</th>
				</tr>
				<tr>
					<th>/</th>
					<th>Linux</th>
					<th>The remainder of the device</th>
				</tr>
			</table>
			<b>UEFI with GPT</b>
			<table>
				<tr>
					<th>Mount point</th>
					<th>Partition type</th>
					<th>Recommended size</th>
				</tr>
				<tr>
					<th>/boot/efi</th>
					<th>EFI</th>
					<th>512MB</th>
				</tr>
				<tr>
					<th>swap</th>
					<th>swap</th>
					<th>4GB+</th>
				</tr>
				<tr>
					<th>/</th>
					<th>Linux x86-64 root</th>
					<th>The remainder of the device</th>
				</tr>
			</table>
			<p class="instructions">
			You can partition /dev/sda with fdisk:
			</p>
			<code>fdisk /dev/sda</code>
			<p class="instructions">
			After partitioning to your needs, you must format the partitions so that they can be used.
			Below is an example for a UEFI system.
			</p>
			<pre><code>mkfs.vfat -F 32 /dev/sda1
mkswap          /dev/sda2
mkfs.ext4       /dev/sda3</code></pre>
			<b>3. Mounting Filesystems</b>
			<p class="instructions">
			Below is an example of how you can mount the partitions according to the UEFI reference table above.
			</p>
			<pre><code>mount --mkdir /dev/sda3 /mnt/whispix
mount --mkdir /dev/sda1 /mnt/whispix/boot/efi
swapon /dev/sda2</code></pre>
			<b>4. The Whispix Bootstrap</b>
			<p class="instructions">
			Whispix uses a shell script to create it's initial system.
			Most of the installed packages will be prebuilt binaries from Arch Linux's repos.
			Because of this, it is highly recommended to rebuild all packages after or towards the end of the install.
			Download the script and make executable:
			</p>
			<pre><code>wget https://raw.githubusercontent.com/catnipsta/whispix/refs/heads/main/whispix-bootstrap.sh
chmod +x whispix-bootstrap.sh</code></pre>
			<p class="instructions">
			If paranoid (don't kill me hardcore UNIX fanboys), you may download the sha256 sum of the bootstrap and
			verify the bootstrap as shown below.
			</p>
			<pre><code>wget https://raw.githubusercontent.com/catnipsta/whispix/refs/heads/main/whispix-bootstrap-sha256
cat whispix-bootstrap-sha256
sha256sum whispix-bootstrap.sh</code></pre>
			<p class="instructions">
			Before running the script, you must install the drag package manager as it is required by the bootstrap script.
			</p>
			<pre><code>git clone https://github.com/catnipsta/drag
chmod +x drag/scripts/*
cp drag/scripts/* /usr/bin/</code></pre>
			<p class="instructions">
			Git, wget, gnupg, rsync, and zstd are also required to run the bootstrap and drag, so ensure those are installed
			as well. Since the bootstrap is a shell script, <b>it is recommended to review and edit it before running.</b>
			You should at the very least review the list of packages that are going to be installed.
			The variable cigs contains the list of packages which are to be installed using Arch's prebuilt binaries.
			If you are uncomfortable with the text editor vi, please replace that package with one you are familiar with.
			It is also advised to set the MAKEFLAGS, CFLAGS, and CXXFLAGS variables before compiling the packages
			in the bootstrap. Below is a common example of how you can set your MAKEFLAGS, CFLAGS, and CXXFLAGS variables.
			</p>
			<pre><code>export MAKEFLAGS="-j$(nproc)"
export CFLAGS="-march=native -O2 -pipe"
export CXXFLAGS="$CFLAGS"</code></pre>
			<p class="instructions">
			With the bootstrap edited to your likings and the compile variables set,
			you may now run the bootstrap script. Make sure to pass your target mount point as a parameter.
			</p>
			<code>
			./whispix-boostrap.sh /mnt/whispix
			</code>
			<p class="instructions">
			If the bootstrap fails, you may re-run the script to try again.
			</p>
			<p class="instructions">
			Edit /mnt/whispix/etc/profile to set your compile flags for the new system.
			If following the guide closely, the lines added should look very similar to what is shown below.
			</p>
			<pre><code>MAKEFLAGS="-j$(nproc)"
CFLAGS="-march=native -O2 -pipe"
CXXFLAGS="$CFLAGS"</code></pre>
			<p class="instructions">
			Before compiling the toolchain inside the chroot, we must add the Linux kernel headers. You can download your
			desired Linux kernel from kernel.org. <b>It is HIGHLY recommended to download a slightly older,
			stable kernel version. This will render a much easier system to maintain.</b>
			Below is an example of how you can download the Linux kernel 6.1.142, extract it, and install the kernel headers.
			You can verify it's signature as well, though not required. Remember that you must be very careful to not
			accidently click on the ads on kernel.org that tell you about hot singles in your area. THEY AREN'T REAL.
			</p>
			<pre><code>cd /mnt/whispix/usr/src
wget https://cdn.kernel.org/pub/linux/kernel/v6.x/linux-6.1.142.tar.xz
tar xJf linux-6.1.142.tar.xz
rm linux-6.1.142.tar.xz
cd linux-6.1.142
make mrproper
make headers
make INSTALL_HDR_PATH=/mnt/whispix/usr headers_install</code></pre>
			<b>5. Chroot</b>
			<p class="instructions">
			Before chrooting to our target mount point, it is necessary to mount some temporary filesystems.
			</p>
			<pre><code>mount -t proc /proc /mnt/whispix/proc
mount -R /sys /mnt/whispix/sys
mount --make-rslave /mnt/whispix/sys
mount -R /dev /mnt/whispix/dev
mount --make-rslave /mnt/whispix/dev
mount -B /run /mnt/whispix/run
mount --make-slave /mnt/whispix/run</code></pre>
			<p class="instructions">
			With the necessary filesystems mounted, we may now enter the chroot environment.
			</p>
			<pre><code>chroot /mnt/whispix /bin/bash
source /etc/profile
export PS1="(chroot) ${PS1}"</code></pre>
			<b>6. Recompiling the toolchain</b>
			<p class="instructions">
			Though we aren't doing a full LFS-style multi-stage bootstrap, it's still recommended to recompile the
			toolchain to ensure that it's only linked to libraries inside of the chroot. We will start with binutils.
			Remember that it is going to prompt you to edit the PKGBUILD first.
			</p>
			<code>
			roll binutils
			</code>
			<p class="instructions">
			Now that you have created the new binaries for binutils, we must uninstall the old binutils and install
			the new one.
			</p>
			<pre><code>stub binutils
smoke binutils
</code></pre>
			<p class="instructions">
			Now we must rebuild glibc which will require us to leave the chroot to replace the old glibc with the new one.
			Drag makes this easier than it may sound. First, roll the new glibc.
			<b>Remember: It is HIGHLY recommended to change the source of glibc
			to download an older, more stable version. This will render a much easier system to maintain.</b>
			</p>
			<code>
			roll glibc
			</code>
			<p class="instructions">
			You must exit the chroot and make use of the DRAG_ROOT variable to modify the target system from outside
			the chroot.
			</p>
			<pre><code>exit
export DRAG_ROOT=/mnt/whispix
stub glibc
smoke glibc
unset DRAG_ROOT
</code></pre>
			<p class="instructions">
			If executed successfully, You may now re-enter the chroot.
			</p>
			<pre><code>chroot /mnt/whispix /bin/bash
source /etc/profile
export PS1="(chroot) ${PS1}"</code></pre>
			<p class="instructions">
			With glibc, we must generate and set our locales as well as create certain configuration files.
			The most common and recommended locales to generate are C.UTF-8 ttys and en_US.UTF-8.
			</p>
			<pre><code>localedef -i C -f UTF-8 C.UTF-8
localedef -i en_US -f UTF-8 en_US.UTF-8
echo "LANG=en_US.UTF-8" > /etc/locale.conf</code></pre>
			<p class="instructions">
			It is highly recommended to create /etc/nsswitch.conf for modern systems.
			</p>
			<pre><code>cat > /etc/nsswitch.conf << "EOF"
passwd: files
group: files
shadow: files

hosts: files dns
networks: files

protocols: files
services: files
ethers: files
rpc: files
EOF</code></pre>
			<p class="instructions">
			To tell the dynamic loader to look in directories besides /usr/lib, we must create /etc/ld.so.conf.
			You can add /usr/local/lib to the directories that the dynamic loader looks as seen below.
			</p>
			<code>echo "/usr/local/lib" > /etc/ld.so.conf</code>
			<p class="instructions">
			Install tzdata using the drag package manager.
			</p>
			<code>smoke tzdata</code>
			<p class="instructions">
			Set your time zone by setting a symlink to /etc/localtime.
			Replace the ??? in the command below with your corresponding time zone. For example: US/Pacific.
			</p>
			<code>ln -sf /usr/share/zoneinfo/??? /etc/localtime</code>
			<p class="instructions">
			Recompile gcc, uninstall the old one, and install the new one.
			<b>Remember: It is HIGHLY recommended to change the source of gcc
			to download an older, more stable version. This will render a much easier system to maintain.</b>
			</p>
			<pre><code>roll gcc
stub gcc
smoke gcc</code></pre>
			<b>7. Compiling the Kernel</b>
			<p class="instructions">
			Everyone is going to compile their kernel differently depending on their hardware, needs, and preferences.
			Some people prefer to use an initramfs to load kernel modules at the init stage, while others compile everything
			they need directly into their kernel. This guide will not be going over how you can setup initramfs, though you
			can find some really good documentation on initramfs from sources like <a href="https://gentoo.org">gentoo.org</a>.
			If you do end up setting an initramfs, remember that you will have to setup its startup in /sbin/init.
			</p>
			<p class="instructions">
			To configure your kernel, you can either manually edit /usr/src/linux-x.x.x/.config or you can use a tool like
			menuconfig or nconfig. You can also set the variable EXTRAVERSION in the Makefile to "-whispix" to generate a
			kernel with the ending "-whispix".
			Below is an example of how you can configure, compile, and install the Linux kernel 6.1.142.
			</p>
			<pre><code>cd /usr/src/linux-6.1.142
make nconfig
make
make install</code></pre>
			<b>8. User and password setup</b>
			<p class="instructions">
			Setting up users and passwords is rather simple compared to the rest of this guide.
			You can optionally set a password for root as so:
			</p>
			<code>
			passwd
			</code>
			<p class="instructions">
			You can add a user named "whispix-user" and create their home directory like this:
			</p>
			<code>
			useradd -m whispix-user
			</code>
			<p class="instructions">
			You can also add whispix-user to the wheel group if you'd like.
			</p>
			<code>
			usermod -aG wheel whispix-user
			</code>
			</br>
			<b>9. Bootloader Setup</b>
			<p class="instructions">
			There are quite a few different bootloaders to choose from though, the most common and featured one is GRUB.
			You can install GRUB using the drag package manager.
			</p>
			<code>
			smoke grub
			</code>
			<p class="instructions">
			If you are running a UEFI system, you will most likely want to additionally install efibootmgr. You may also
			need to mount your efivars for GRUB and efibootmgr to detect that you are on an EFI system. You can do this
			as shown below.
			</p>
			<code>
			mount -t efivarfs efivarfs /sys/firmware/efi/efivars
			</code>
			<p class="instructions">
			You can install GRUB for 32 and 64 bit BIOS systems assuming that your target is /dev/sda with
			the commands shown below.
			</p>
			<pre><code>grub-install --target=i386-pc /dev/sda
grub-mkconfig /boot/grub/grub.cfg</code></pre>
			<p class="instructions">
			You can install GRUB for 64 bit UEFI systems assuming that your efi
			directory is /boot/efi with the commands shown below.
			</p>
			<pre><code>grub-install --target=x86_64-efi --efi-directory=/boot/efi
grub-mkconfig /boot/grub/grub.cfg</code></pre>
			<b>10. The Finishing Touches</b>
			<p class="instructions">
			At this point of the installation, it is recommended to rebuild the prebuilt Arch Linux binaries.
			This can be done similarly to how the packages in step 6 were rebuilt.
			You can list all of your smoked packages by running:<code>drag</code>
			Some people may also choose to install and setup sudo for their user.
			As you could have probably guessed by now, you can install sudo using the smoke command.
			People may also choose to setup certain startup services at this point. Unlike practically every
			Linux distribution, Whispix does not come with an init system unless you install one yourself. 
			It instead comes with a basic shell script at /sbin/init that you can add your startup services
			to.
			</p>
			<p class="instructions">
			You may now exit the chroot, unmount your newly created system, and reboot.
			</p>
			<pre><code>exit
umount -R /mnt/whispix
reboot</code></pre>
		</main>
		<footer>
			<p>2025 Catnipsta - Nikolai Klover - GPLv3</p>
		</footer>
	</body>
</html>
